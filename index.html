<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#dff1ff" />
  <title>ÎùºÏù¥Î∏åÎçîÏÑºÌÖÄ Ï£ºÏ∞®ÏúÑÎ∞ò Ï†úÎ≥¥</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    :root{
      --card: rgba(255,255,255,.96);
      --text:#1f2937;
      --muted:#6b7280;
      --line:rgba(31,41,55,.08);

      /* primary (sky) */
      --primary:#3b82f6;
      --primary2:#2563eb;
      --primarySoft:rgba(59,130,246,.14);

      --sage:#22c55e;
      --danger:#ef4444;
      --success:#16a34a;

      --radius:22px;
      --shadow:0 14px 34px rgba(15,23,42,.08);
      --shadow2:0 10px 22px rgba(15,23,42,.06);
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}

    html,body{
      min-height:100%;
      font-family:"Noto Sans KR",-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
      color:var(--text);
      overflow-x:hidden;

      /* üå§ sky + clouds */
      background:
        radial-gradient(120px 60px at 20% 18%, rgba(255,255,255,.75) 0%, transparent 70%),
        radial-gradient(160px 80px at 70% 22%, rgba(255,255,255,.65) 0%, transparent 70%),
        radial-gradient(220px 110px at 45% 32%, rgba(255,255,255,.55) 0%, transparent 70%),
        radial-gradient(180px 90px at 86% 38%, rgba(255,255,255,.50) 0%, transparent 70%),
        linear-gradient(180deg, #dff1ff 0%, #edf7ff 35%, #f7fbff 60%, #ffffff 100%);
    }

    /* disable zoom gestures (mobile) */
    .no-zoom {
      touch-action: manipulation;
    }

    .screen{
      position:relative;
      z-index:1;
      padding:18px 16px calc(118px + env(safe-area-inset-bottom));
      max-width:640px;
      margin:0 auto;
    }

    /* üè¢ Apartment silhouette at bottom */
    .apt-bg{
      position:fixed;
      left:0; right:0; bottom:0;
      height:190px;
      pointer-events:none;
      z-index:0;
      background: linear-gradient(to top, rgba(100,116,139,.18), rgba(100,116,139,.08), transparent);
      mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 300'>\
<rect x='0' y='135' width='120' height='165' rx='8'/>\
<rect x='140' y='85' width='150' height='215' rx='10'/>\
<rect x='320' y='155' width='110' height='145' rx='8'/>\
<rect x='460' y='65' width='170' height='235' rx='12'/>\
<rect x='660' y='105' width='140' height='195' rx='10'/>\
<rect x='820' y='150' width='120' height='150' rx='8'/>\
</svg>");
      -webkit-mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 300'>\
<rect x='0' y='135' width='120' height='165' rx='8'/>\
<rect x='140' y='85' width='150' height='215' rx='10'/>\
<rect x='320' y='155' width='110' height='145' rx='8'/>\
<rect x='460' y='65' width='170' height='235' rx='12'/>\
<rect x='660' y='105' width='140' height='195' rx='10'/>\
<rect x='820' y='150' width='120' height='150' rx='8'/>\
</svg>");
      mask-size: cover;
      -webkit-mask-size: cover;
      mask-repeat: no-repeat;
      -webkit-mask-repeat: no-repeat;
      opacity:.95;
    }

    /* Header */
    .header{ margin:14px 0 12px; text-align:left; }
    .header-icon{
      display:inline-flex;
      width:54px;height:54px;
      border-radius:18px;
      align-items:center;justify-content:center;
      font-size:28px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.85) 0%, rgba(255,255,255,.25) 55%, transparent 70%),
        linear-gradient(135deg, rgba(59,130,246,.38), rgba(34,197,94,.18));
      border:1px solid rgba(255,255,255,.65);
      box-shadow:var(--shadow2);
      margin-bottom:10px;
    }
    h1{ font-size:26px; font-weight:900; letter-spacing:-.6px; line-height:1.15; }
    .subtitle{ margin-top:6px; font-size:14px; color:var(--muted); font-weight:600; }

    /* Banner */
    .banner{
      border-radius:24px;
      padding:18px;
      margin:14px 0 18px;
      background:
        radial-gradient(420px 220px at 15% 40%, rgba(59,130,246,.16) 0%, transparent 60%),
        radial-gradient(420px 260px at 85% 60%, rgba(34,197,94,.12) 0%, transparent 62%),
        linear-gradient(135deg, #ffffff 0%, #f2f8ff 52%, #f2fff9 100%);
      border:1px solid rgba(255,255,255,.72);
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .banner::after{
      content:"";
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(circle at 25% 35%, rgba(255,255,255,.55) 0%, transparent 55%),
        radial-gradient(circle at 75% 65%, rgba(255,255,255,.45) 0%, transparent 55%);
      pointer-events:none;
    }
    .banner-content{position:relative; z-index:1;}
    .banner-title{font-size:16px; font-weight:900; letter-spacing:-.3px;}
    .banner-desc{margin-top:6px; font-size:13px; color:var(--muted); font-weight:600;}

    /* Section */
    .section{
      margin:18px 0 10px;
      font-size:15px;
      font-weight:900;
      letter-spacing:-.2px;
      color:#334155;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .section-icon{
      font-size:18px;
      width:26px;height:26px;
      display:inline-flex;
      align-items:center;justify-content:center;
      border-radius:10px;
      background:rgba(59,130,246,.14);
      color:var(--primary2);
    }

    /* Card */
    .card{
      background:var(--card);
      backdrop-filter: blur(10px);
      border-radius:22px;
      padding:18px;
      margin-bottom:12px;
      border:1px solid rgba(31,41,55,.06);
      box-shadow:var(--shadow2);
    }
    label{
      font-weight:900;
      font-size:15px;
      display:flex;
      align-items:center;
      gap:8px;
      letter-spacing:-.2px;
    }
    .label-icon{
      width:26px;height:26px;
      display:inline-flex;
      align-items:center;justify-content:center;
      border-radius:10px;
      background:rgba(34,197,94,.12);
      color:#15803d;
      font-size:16px;
    }
    .hint{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      font-weight:600;
      line-height:1.45;
    }

    /* Inputs */
    input[type="text"], textarea{
      width:100%;
      margin-top:12px;
      padding:14px 14px;
      border-radius:16px;
      border:1.5px solid rgba(31,41,55,.10);
      background:rgba(255,255,255,.92);
      font-size:16px; /* iOS zoom Î∞©ÏßÄ */
      color:var(--text);
      font-family:inherit;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    input[type="text"]::placeholder, textarea::placeholder{ color:#9aa2b1; }
    input[type="text"]:focus, textarea:focus{
      outline:none;
      border-color:rgba(59,130,246,.55);
      box-shadow:0 0 0 4px rgba(59,130,246,.14);
      background:#fff;
    }
    textarea{ min-height:110px; resize:vertical; }

    /* Buttons */
    .btn{
      width:100%;
      margin-top:14px;
      padding:14px 14px;
      border-radius:16px;
      border:1.5px solid rgba(59,130,246,.28);
      background:rgba(255,255,255,.95);
      color:var(--primary2);
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .15s ease, background .15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn:hover{
      background:rgba(59,130,246,.08);
      box-shadow:0 10px 22px rgba(15,23,42,.08);
    }
    .btn:active{ transform:scale(.98); }

    /* count pill */
    .photo-count{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:10px;
      padding:8px 12px;
      background:rgba(34,197,94,.12);
      border:1.5px solid rgba(34,197,94,.18);
      border-radius:999px;
      font-size:12px;
      color:#166534;
      font-weight:900;
    }

    /* Previews */
    .previews{
      display:flex;
      gap:10px;
      margin-top:14px;
      overflow-x:auto;
      padding-bottom:4px;
      -webkit-overflow-scrolling:touch;
    }
    .previews::-webkit-scrollbar{ display:none; }

    .thumb{
      width:104px;height:104px;
      border-radius:18px;
      overflow:hidden;
      position:relative;
      flex-shrink:0;
      border:2px solid rgba(59,130,246,.14);
      box-shadow:0 12px 24px rgba(15,23,42,.08);
      background:#fff;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .thumb button{
      position:absolute;
      top:8px; right:8px;
      width:32px; height:32px;
      border-radius:999px;
      border:none;
      background:rgba(239,68,68,.92);
      color:#fff;
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 8px 18px rgba(239,68,68,.18);
    }

    /* Checkbox */
    .checkbox-label{
      display:flex;
      align-items:flex-start;
      gap:10px;
      cursor:pointer;
      font-weight:900;
      line-height:1.4;
    }
    input[type="checkbox"]{
      width:20px;height:20px;
      accent-color:var(--primary2);
      margin-top:2px;
    }

    /* Bottom CTA */
    .bottom{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 14px calc(10px + env(safe-area-inset-bottom));
      background:rgba(255,255,255,.88);
      backdrop-filter: blur(16px);
      border-top:1px solid rgba(31,41,55,.08);
      z-index:100;
    }
    .bottom-content{ max-width:640px; margin:0 auto; }

    .submit{
      width:100%;
      padding:16px 16px;
      border-radius:18px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 55%, #60a5fa 100%);
      color:#fff;
      font-size:16px;
      font-weight:900;
      border:none;
      cursor:pointer;
      box-shadow:0 16px 30px rgba(37,99,235,.20);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .submit:not(:disabled):active{ transform:scale(.99); }
    .submit:disabled{
      opacity:.45;
      background:#cbd5e1;
      box-shadow:none;
      cursor:not-allowed;
    }

    /* Toast */
    .toast{
      margin-top:10px;
      padding:12px 14px;
      border-radius:16px;
      font-size:14px;
      font-weight:900;
      text-align:center;
      background:rgba(34,197,94,.10);
      border:1.5px solid rgba(34,197,94,.16);
      color:#166534;
    }
    .toast.error{
      background:rgba(239,68,68,.10);
      border-color:rgba(239,68,68,.16);
      color:#991b1b;
    }

    /* Spinner */
    .spinner{
      width:18px;height:18px;
      border:2px solid rgba(255,255,255,.35);
      border-top-color:#fff;
      border-radius:50%;
      animation: spin .7s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }

    @media (max-width:360px){
      h1{ font-size:24px; }
      .card{ padding:16px; }
      .header-icon{ width:50px;height:50px;border-radius:16px; }
    }
    @media (min-width:768px){
      .screen{ padding:26px 22px calc(110px + env(safe-area-inset-bottom)); }
    }
  </style>
</head>

<body class="no-zoom">
  <!-- background silhouette -->
  <div class="apt-bg"></div>

  <div id="root"></div>

  <script>
    // ‚úÖ ÎÑà ÌôòÍ≤ΩÏóê ÎßûÍ≤å Ïú†ÏßÄ (Cloudflare Worker API)
    const API_URL = "https://dawn-frost-9b1a.wlasqqq.workers.dev/api/report";

    const {useState, useRef, useMemo, useEffect} = React;

    function App() {
      const fileRef = useRef();

      const [location, setLocation] = useState("");
      const [plate, setPlate] = useState("");
      const [note, setNote] = useState("");
      const [files, setFiles] = useState([]);
      const [agree, setAgree] = useState(false);
      const [loading, setLoading] = useState(false);
      const [toast, setToast] = useState("");
      const [toastType, setToastType] = useState("success");

      // objectURL ÎàÑÏàò Î∞©ÏßÄ
      const [previewUrls, setPreviewUrls] = useState([]);
      useEffect(() => {
        const urls = files.map(f => URL.createObjectURL(f));
        setPreviewUrls(urls);
        return () => urls.forEach(u => URL.revokeObjectURL(u));
      }, [files]);

      const canSubmit = useMemo(
        () => location.trim() && plate.trim() && files.length > 0 && agree && !loading,
        [location, plate, files, agree, loading]
      );

      function onFiles(e) {
        const picked = Array.from(e.target.files || []);
        if (!picked.length) return;

        // Ï§ëÎ≥µ Î∞©ÏßÄ (name+size+lastModified)
        setFiles(prev => {
          const map = new Map(prev.map(f => [f.name+"_"+f.size+"_"+f.lastModified, f]));
          for (const f of picked) map.set(f.name+"_"+f.size+"_"+f.lastModified, f);
          return Array.from(map.values());
        });

        e.target.value = "";
      }

      function remove(idx) {
        setFiles(f => f.filter((_, i) => i !== idx));
      }

      function toBase64(f) {
        return new Promise((resolve, reject) => {
          const fr = new FileReader();
          fr.onload = () => resolve(fr.result);
          fr.onerror = reject;
          fr.readAsDataURL(f);
        });
      }

      async function submit() {
        setToast("");
        setLoading(true);

        try {
          const images = [];
          for (const f of files) images.push(await toBase64(f));

          const res = await fetch(API_URL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
              location: location.trim(),
              plate: plate.trim(),
              note: note.trim(),
              images,
              ip: "-" // ÌïÑÏöîÌïòÎ©¥ ÏõåÏª§ÏóêÏÑú ip Ï£ºÏûÖ
            })
          });

          if (!res.ok) {
            const t = await res.text().catch(()=> "");
            throw new Error(t || ("HTTP " + res.status));
          }

          setToastType("success");
          setToast("‚úÖ Ï†ëÏàòÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. Í∞êÏÇ¨Ìï©ÎãàÎã§!");
          setLocation("");
          setPlate("");
          setNote("");
          setFiles([]);
          setAgree(false);

          setTimeout(() => setToast(""), 3000);
        } catch (e) {
          setToastType("error");
          setToast("‚ùå Ï†úÏ∂úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
        } finally {
          setLoading(false);
        }
      }

      return React.createElement("div", {className: "screen"},
        React.createElement("div", {className: "header"},
          React.createElement("h1", null, "üö´ ÎùºÏù¥Î∏åÎçîÏÑºÌÖÄ Ï£ºÏ∞®ÏúÑÎ∞ò Ï†úÎ≥¥"),
          React.createElement("div", {className: "subtitle"}, "Ïö∞Î¶¨ Îã®ÏßÄÏùò ÏïàÏ†ÑÌïú Ï£ºÏ∞® Î¨∏ÌôîÎ•º Ìï®Íªò ÎßåÎì§Ïñ¥Í∞ÄÏöî")
        ),

        React.createElement("div", {className: "banner"},
          React.createElement("div", {className: "banner-content"},
            React.createElement("div", {className: "banner-title"}, "Î∂àÎ≤ï Ï£ºÏ∞® Î∞è ÏúÑÎ∞ò ÏÇ¨Ìï≠ÏùÑ Ï†úÎ≥¥Ìï¥ Ï£ºÏÑ∏Ïöî"),
            React.createElement("div", {className: "banner-desc"}, "ÏúÑÎ∞ò ÏÇ¨Ïã§Ïù¥ Î™ÖÌôïÌûà ÌôïÏù∏Îê† Ïàò ÏûàÎèÑÎ°ù Ï¶ùÍ±∞ÏÇ¨ÏßÑÏùÑ Ï†úÏ∂úÌï¥ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.")
          )
        ),

        React.createElement("div", {className: "section"},
          React.createElement("span", {className: "section-icon"}, "üìã"),
          "Ïã†Í≥† ÎÇ¥Ïö©"
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "üìç"),
            "ÏúÑÏπò"
          ),
          React.createElement("div", {className: "hint"}, "Îèô¬∑Ï∏µ¬∑Íµ¨Ïó≠ÏùÑ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî"),
          React.createElement("input", {
            type: "text",
            value: location,
            onChange: e => setLocation(e.target.value),
            placeholder: "Ïòà: 101Îèô B2Ï∏µ AÍµ¨Ïó≠"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "üöó"),
            "Ï∞®ÎüâÎ≤àÌò∏"
          ),
          React.createElement("div", {className: "hint"}, "Ï∞®ÎüâÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî"),
          React.createElement("input", {
            type: "text",
            value: plate,
            onChange: e => setPlate(e.target.value),
            placeholder: "Ïòà: 12Í∞Ä3456",
            autoCapitalize: "characters"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "üì∏"),
            "ÏÇ¨ÏßÑ"
          ),
          React.createElement("div", {className: "hint"}, "Î≤àÌò∏ÌåêÍ≥º Ï£ºÏ∞® ÏúÑÏπòÍ∞Ä Ìï®Íªò Î≥¥Ïù¥Í≤å Ï¥¨ÏòÅÌï¥ Ï£ºÏÑ∏Ïöî"),
          files.length > 0 && React.createElement("div", {className: "photo-count"},
            `üìé ÏÇ¨ÏßÑ ${files.length}Ïû• Ï≤®Î∂ÄÎê®`
          ),

          React.createElement("button", {
            className: "btn",
            type: "button",
            onClick: () => fileRef.current && fileRef.current.click()
          }, "ÏÇ¨ÏßÑ Ï¥¨ÏòÅ/Ï∂îÍ∞Ä"),

          React.createElement("input", {
            ref: fileRef,
            type: "file",
            accept: "image/*",
            multiple: true,
            capture: "environment",
            onChange: onFiles,
            style: {display: "none"}
          }),

          previewUrls.length > 0 && React.createElement("div", {className: "previews"},
            previewUrls.map((url, i) =>
              React.createElement("div", {className: "thumb", key: i},
                React.createElement("img", {src: url, alt: "preview"}),
                React.createElement("button", {type:"button", onClick: () => remove(i)}, "√ó")
              )
            )
          )
        ),

        React.createElement("div", {className: "section"},
          React.createElement("span", {className: "section-icon"}, "üìù"),
          "Ï∂îÍ∞Ä Ï†ïÎ≥¥"
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "üìù"),
            "ÎπÑÍ≥† (ÏÑ†ÌÉù)"
          ),
          React.createElement("div", {className: "hint"}, "ÏÉÅÏäµ/Î∞òÎ≥µ Ïó¨Î∂Ä, ÌäπÏù¥ÏÇ¨Ìï≠Ïù¥ ÏûàÏúºÎ©¥ ÎÇ®Í≤® Ï£ºÏÑ∏Ïöî"),
          React.createElement("textarea", {
            value: note,
            onChange: e => setNote(e.target.value),
            placeholder: "Ïòà: 3Ïùº Ïó∞ÏÜç Í∞ôÏùÄ ÏûêÎ¶¨ Ï£ºÏ∞®, ÌÜµÌñâ Î∞©Ìï¥ Îì±"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", {className: "checkbox-label"},
            React.createElement("input", {
              type: "checkbox",
              checked: agree,
              onChange: e => setAgree(e.target.checked)
            }),
            "Ï¶ùÍ±∞ Ï†úÍ≥µ Î∞è Ï≤òÎ¶¨Ïóê ÎèôÏùòÌï©ÎãàÎã§"
          ),
          React.createElement("div", {className: "hint", style: {marginTop: "10px"}},
            `‚úì ÏúÑÏπò: ${location ? 'ÏûÖÎ†•Îê®' : 'ÎØ∏ÏûÖÎ†•'} | Ï∞®ÎüâÎ≤àÌò∏: ${plate ? 'ÏûÖÎ†•Îê®' : 'ÎØ∏ÏûÖÎ†•'} | ÏÇ¨ÏßÑ: ${files.length}Ïû• | ÎèôÏùò: ${agree ? 'ÏôÑÎ£å' : 'ÌïÑÏöî'}`
          )
        ),

        React.createElement("div", {className: "bottom"},
          React.createElement("div", {className: "bottom-content"},
            React.createElement("button", {
              className: "submit",
              disabled: !canSubmit,
              onClick: submit
            },
              loading && React.createElement("div", {className: "spinner"}),
              loading ? "Ï†úÏ∂ú Ï§ë..." : "Ï†úÎ≥¥ Ï†úÏ∂ú"
            ),
            toast && React.createElement("div", {className: `toast ${toastType === 'error' ? 'error' : ''}`}, toast)
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>

  <script>
    // iOS/Î™®Î∞îÏùº ÌïÄÏπò Ï§å Î∞©ÏßÄ(ÌïÑÏöîÏãú)
    (function disableZoom(){
      document.addEventListener('gesturestart', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('gesturechange', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('gestureend', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('touchmove', function(e){
        if (e.scale && e.scale !== 1) e.preventDefault();
      }, { passive:false });
    })();
  </script>
</body>
</html>
