<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#dff1ff" />
  <title>ë¼ì´ë¸Œë”ì„¼í…€ ì£¼ì°¨ìœ„ë°˜ ì œë³´</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    :root{
      --card: rgba(255,255,255,.96);
      --text:#1f2937;
      --muted:#6b7280;
      --line:rgba(31,41,55,.08);

      /* primary (sky) */
      --primary:#3b82f6;
      --primary2:#2563eb;
      --primarySoft:rgba(59,130,246,.14);

      --sage:#22c55e;
      --danger:#ef4444;
      --success:#16a34a;

      --radius:22px;
      --shadow:0 14px 34px rgba(15,23,42,.08);
      --shadow2:0 10px 22px rgba(15,23,42,.06);
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}

    html,body{
      min-height:100%;
      font-family:"Noto Sans KR",-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
      color:var(--text);
      overflow-x:hidden;

      /* ğŸŒ¤ sky + clouds */
      background:
        radial-gradient(120px 60px at 20% 18%, rgba(255,255,255,.75) 0%, transparent 70%),
        radial-gradient(160px 80px at 70% 22%, rgba(255,255,255,.65) 0%, transparent 70%),
        radial-gradient(220px 110px at 45% 32%, rgba(255,255,255,.55) 0%, transparent 70%),
        radial-gradient(180px 90px at 86% 38%, rgba(255,255,255,.50) 0%, transparent 70%),
        linear-gradient(180deg, #dff1ff 0%, #edf7ff 35%, #f7fbff 60%, #ffffff 100%);
    }

    /* disable zoom gestures (mobile) */
    .no-zoom { touch-action: manipulation; }

    .screen{
      position:relative;
      z-index:1;
      padding:18px 16px calc(118px + env(safe-area-inset-bottom));
      max-width:640px;
      margin:0 auto;
    }

    /* ğŸ¢ Apartment silhouette at bottom */
    .apt-bg{
      position:fixed;
      left:0; right:0; bottom:0;
      height:190px;
      pointer-events:none;
      z-index:0;
      background: linear-gradient(to top, rgba(100,116,139,.18), rgba(100,116,139,.08), transparent);
      mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 300'>\
<rect x='0' y='135' width='120' height='165' rx='8'/>\
<rect x='140' y='85' width='150' height='215' rx='10'/>\
<rect x='320' y='155' width='110' height='145' rx='8'/>\
<rect x='460' y='65' width='170' height='235' rx='12'/>\
<rect x='660' y='105' width='140' height='195' rx='10'/>\
<rect x='820' y='150' width='120' height='150' rx='8'/>\
</svg>");
      -webkit-mask-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 300'>\
<rect x='0' y='135' width='120' height='165' rx='8'/>\
<rect x='140' y='85' width='150' height='215' rx='10'/>\
<rect x='320' y='155' width='110' height='145' rx='8'/>\
<rect x='460' y='65' width='170' height='235' rx='12'/>\
<rect x='660' y='105' width='140' height='195' rx='10'/>\
<rect x='820' y='150' width='120' height='150' rx='8'/>\
</svg>");
      mask-size: cover;
      -webkit-mask-size: cover;
      mask-repeat: no-repeat;
      -webkit-mask-repeat: no-repeat;
      opacity:.95;
    }

    /* Header */
    .header{ margin:14px 0 12px; text-align:left; }
    h1{ font-size:26px; font-weight:900; letter-spacing:-.6px; line-height:1.15; }
    .subtitle{ margin-top:6px; font-size:14px; color:var(--muted); font-weight:600; }

    /* Banner */
    .banner{
      border-radius:24px;
      padding:18px;
      margin:14px 0 18px;
      background:
        radial-gradient(420px 220px at 15% 40%, rgba(59,130,246,.16) 0%, transparent 60%),
        radial-gradient(420px 260px at 85% 60%, rgba(34,197,94,.12) 0%, transparent 62%),
        linear-gradient(135deg, #ffffff 0%, #f2f8ff 52%, #f2fff9 100%);
      border:1px solid rgba(255,255,255,.72);
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
      animation: floatIn .28s ease-out both;
    }
    .banner::after{
      content:"";
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(circle at 25% 35%, rgba(255,255,255,.55) 0%, transparent 55%),
        radial-gradient(circle at 75% 65%, rgba(255,255,255,.45) 0%, transparent 55%);
      pointer-events:none;
    }
    .banner-content{position:relative; z-index:1;}
    .banner-title{font-size:16px; font-weight:900; letter-spacing:-.3px;}
    .banner-desc{margin-top:6px; font-size:13px; color:var(--muted); font-weight:600;}

    /* Section */
    .section{
      margin:18px 0 10px;
      font-size:15px;
      font-weight:900;
      letter-spacing:-.2px;
      color:#334155;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .section-icon{
      font-size:18px;
      width:26px;height:26px;
      display:inline-flex;
      align-items:center;justify-content:center;
      border-radius:10px;
      background:rgba(59,130,246,.14);
      color:var(--primary2);
    }

    /* Card */
    .card{
      background:var(--card);
      backdrop-filter: blur(10px);
      border-radius:22px;
      padding:18px;
      margin-bottom:12px;
      border:1px solid rgba(31,41,55,.06);
      box-shadow:var(--shadow2);
      animation: floatIn .28s ease-out both;
      animation-delay: .02s;
    }
    label{
      font-weight:900;
      font-size:15px;
      display:flex;
      align-items:center;
      gap:8px;
      letter-spacing:-.2px;
    }
    .label-icon{
      width:26px;height:26px;
      display:inline-flex;
      align-items:center;justify-content:center;
      border-radius:10px;
      background:rgba(34,197,94,.12);
      color:#15803d;
      font-size:16px;
    }
    .hint{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      font-weight:600;
      line-height:1.45;
    }

    /* Inputs */
    input[type="text"], textarea{
      width:100%;
      margin-top:12px;
      padding:14px 14px;
      border-radius:16px;
      border:1.5px solid rgba(31,41,55,.10);
      background:rgba(255,255,255,.92);
      font-size:16px; /* iOS zoom ë°©ì§€ */
      color:var(--text);
      font-family:inherit;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    input[type="text"]::placeholder, textarea::placeholder{ color:#9aa2b1; }
    input[type="text"]:focus, textarea:focus{
      outline:none;
      border-color:rgba(59,130,246,.55);
      box-shadow:0 0 0 4px rgba(59,130,246,.14);
      background:#fff;
    }
    textarea{ min-height:110px; resize:vertical; }

    /* Buttons */
    .btn{
      width:100%;
      margin-top:14px;
      padding:14px 14px;
      border-radius:16px;
      border:1.5px solid rgba(59,130,246,.28);
      background:rgba(255,255,255,.95);
      color:var(--primary2);
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .18s ease, background .15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn:hover{
      background:rgba(59,130,246,.08);
      box-shadow:0 10px 22px rgba(15,23,42,.08);
    }
    .btn:active{ transform:scale(.985); }

    /* count pill */
    .photo-count{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:10px;
      padding:8px 12px;
      background:rgba(34,197,94,.12);
      border:1.5px solid rgba(34,197,94,.18);
      border-radius:999px;
      font-size:12px;
      color:#166534;
      font-weight:900;
    }
    .photo-limit{
      margin-top:10px;
      font-size:12px;
      color:rgba(15,23,42,.62);
      font-weight:800;
    }

    /* Previews */
    .previews{
      display:flex;
      gap:10px;
      margin-top:14px;
      overflow-x:auto;
      padding-bottom:4px;
      -webkit-overflow-scrolling:touch;
    }
    .previews::-webkit-scrollbar{ display:none; }

    .thumb{
      width:104px;height:104px;
      border-radius:18px;
      overflow:hidden;
      position:relative;
      flex-shrink:0;
      border:2px solid rgba(59,130,246,.14);
      box-shadow:0 12px 24px rgba(15,23,42,.08);
      background:#fff;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .thumb button{
      position:absolute;
      top:8px; right:8px;
      width:32px; height:32px;
      border-radius:999px;
      border:none;
      background:rgba(239,68,68,.92);
      color:#fff;
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 8px 18px rgba(239,68,68,.18);
    }

    /* Checkbox */
    .checkbox-label{
      display:flex;
      align-items:flex-start;
      gap:10px;
      cursor:pointer;
      font-weight:900;
      line-height:1.4;
    }
    input[type="checkbox"]{
      width:20px;height:20px;
      accent-color:var(--primary2);
      margin-top:2px;
    }

    /* Bottom CTA */
    .bottom{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 14px calc(10px + env(safe-area-inset-bottom));
      background:rgba(255,255,255,.88);
      backdrop-filter: blur(16px);
      border-top:1px solid rgba(31,41,55,.08);
      z-index:100;
    }
    .bottom-content{ max-width:640px; margin:0 auto; }

    .submit{
      width:100%;
      padding:16px 16px;
      border-radius:18px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 55%, #60a5fa 100%);
      color:#fff;
      font-size:16px;
      font-weight:900;
      border:none;
      cursor:pointer;
      box-shadow:0 16px 30px rgba(37,99,235,.20);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: transform .12s ease, box-shadow .18s ease, filter .18s ease;
    }
    .submit:not(:disabled):active{ transform:scale(.985); filter: brightness(0.98); }
    .submit:disabled{
      opacity:.45;
      background:#cbd5e1;
      box-shadow:none;
      cursor:not-allowed;
    }
    .submit:not(:disabled){
      box-shadow: 0 18px 34px rgba(37,99,235,.26);
    }

    /* Toast */
    .toast{
      margin-top:10px;
      padding:12px 14px;
      border-radius:16px;
      font-size:14px;
      font-weight:900;
      text-align:center;
      background:rgba(34,197,94,.10);
      border:1.5px solid rgba(34,197,94,.16);
      color:#166534;
      white-space:pre-wrap;
      word-break:break-word;
      animation: toastUp .22s ease-out both;
    }
    .toast.error{
      background:rgba(239,68,68,.10);
      border-color:rgba(239,68,68,.16);
      color:#991b1b;
    }

    /* Spinner */
    .spinner{
      width:18px;height:18px;
      border:2px solid rgba(255,255,255,.35);
      border-top-color:#fff;
      border-radius:50%;
      animation: spin .7s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }

    /* Animations */
    @keyframes floatIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes toastUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Loading Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.35);
      backdrop-filter: blur(6px);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .modal{
      width:min(420px, 92vw);
      background:rgba(255,255,255,.96);
      border:1px solid rgba(255,255,255,.7);
      border-radius:22px;
      box-shadow:0 20px 50px rgba(15,23,42,.18);
      padding:18px;
      animation: floatIn .18s ease-out both;
    }
    .modal-title{
      font-size:16px;
      font-weight:900;
      letter-spacing:-.2px;
    }
    .modal-desc{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      font-weight:700;
      line-height:1.45;
      white-space:pre-line;
    }
    .modal-row{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:14px;
    }
    .modal-spinner{
      width:18px;height:18px;
      border:2px solid rgba(37,99,235,.25);
      border-top-color: var(--primary2);
      border-radius:50%;
      animation: spin .7s linear infinite;
    }

    @media (max-width:360px){
      h1{ font-size:24px; }
      .card{ padding:16px; }
    }
    @media (min-width:768px){
      .screen{ padding:26px 22px calc(110px + env(safe-area-inset-bottom)); }
    }
    /* PC Block Screen */
    .pcblock-wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .pcblock-card{
      width:min(420px, 92vw);
      background:rgba(255,255,255,.96);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;
      box-shadow:0 20px 50px rgba(15,23,42,.14);
      padding:26px 22px;
      text-align:center;
      animation: floatIn .22s ease-out both;
    }
    .pcblock-emoji{
      font-size:44px;
      margin-bottom:10px;
    }
    .pcblock-title{
      font-size:18px;
      font-weight:900;
      letter-spacing:-.3px;
    }
    .pcblock-desc{
      margin-top:10px;
      font-size:14px;
      color:#64748b;
      font-weight:800;
      line-height:1.55;
      white-space:pre-line;
    }
        /* PC Block Toast */
    .pc-toast{
      position:fixed;
      top:18px;
      left:50%;
      transform:translateX(-50%);
      z-index:10000;
      background:rgba(15,23,42,.92);
      color:#fff;
      padding:12px 16px;
      border-radius:14px;
      font-size:14px;
      font-weight:900;
      box-shadow:0 14px 30px rgba(15,23,42,.35);
      animation: toastDrop .28s ease-out both;
      white-space:pre-line;
      text-align:center;
    }

@keyframes toastDrop{
  from{ opacity:0; transform:translate(-50%,-8px); }
  to{ opacity:1; transform:translate(-50%,0); }
}

    
  </style>
</head>

<body class="no-zoom">
  <div class="apt-bg"></div>
  <div id="root"></div>

  <script>
    // âœ… ë„¤ Cloudflare Worker API (ì •í™•í•œ ì£¼ì†Œë¡œ!)
    const API_URL = "https://dawn-frost-9b1a.wlalsqqq.workers.dev/api/report";

    // âœ… ì†ë„/ì•ˆì •í™” ì„¤ì •
    const MAX_PHOTOS = 5;       // ìµœëŒ€ ì‚¬ì§„ ì¥ìˆ˜
    const MAX_WIDTH = 1024;     // ì••ì¶• ìµœëŒ€ í­ (ê¸°ì¡´ 1280 â†’ 1024)
    const JPEG_QUALITY = 0.72;  // ì••ì¶• í’ˆì§ˆ (ê¸°ì¡´ 0.82 â†’ 0.72)

    const {useState, useRef, useMemo, useEffect} = React;
    
function isMobileDevice() {
  const ua = navigator.userAgent || "";
  const isMobileUA = /Android|iPhone|iPad|iPod/i.test(ua);
  const hasTouch = (navigator.maxTouchPoints > 0) || ("ontouchstart" in window);
  return isMobileUA && hasTouch;
}

function App() {
  const fileRef = useRef();

  // âœ… ê¸°ì¡´ í›…ë“¤(ì „ë¶€ ë¨¼ì € ì„ ì–¸!)
  const [location, setLocation] = useState("");
  const [plate, setPlate] = useState("");
  const [phone, setPhone] = useState("");
  const [note, setNote] = useState("");
  const [files, setFiles] = useState([]);
  const [agree, setAgree] = useState(false);
  const [loading, setLoading] = useState(false);
  const [toast, setToast] = useState("");
  const [toastType, setToastType] = useState("success");

  // âœ… PCì°¨ë‹¨ìš© í›…ë„ ì—¬ê¸°ì„œ ì„ ì–¸
  const [isMobile, setIsMobile] = useState(true);
  const [showPcMsg, setShowPcMsg] = useState(true);

  // objectURL ëˆ„ìˆ˜ ë°©ì§€(ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
  const [previewUrls, setPreviewUrls] = useState([]);
  useEffect(() => {
    const urls = files.map(f => URL.createObjectURL(f));
    setPreviewUrls(urls);
    return () => urls.forEach(u => URL.revokeObjectURL(u));
  }, [files]);

  // ë¡œë”© ì¤‘ ìŠ¤í¬ë¡¤ ì ê¸ˆ(ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
  useEffect(() => {
    document.body.style.overflow = loading ? "hidden" : "";
    return () => { document.body.style.overflow = ""; };
  }, [loading]);

  // âœ… ëª¨ë°”ì¼ íŒë³„(PCë©´ false)
  useEffect(() => {
    setIsMobile(isMobileDevice());
  }, []);

  // âœ… PC ë©”ì‹œì§€ 3ì´ˆ í›„ ìˆ¨ê¹€(ì„ íƒ)
  useEffect(() => {
    if (!isMobile) {
      setShowPcMsg(true);
      const t = setTimeout(() => setShowPcMsg(false), 3000);
      return () => clearTimeout(t);
    }
  }, [isMobile]);

  // âœ… ì—¬ê¸°ì„œ PC ì°¨ë‹¨ return (í›… ì„ ì–¸ ì´í›„ë¼ ì•ˆì „)
  if (!isMobile) {
    return React.createElement(React.Fragment, null,
      showPcMsg && React.createElement("div", { className: "pc-toast" },
        "âš ï¸ ëª¨ë°”ì¼ ì „ìš© ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤\nPCì—ì„œëŠ” ì ‘ìˆ˜ê°€ ì œí•œë©ë‹ˆë‹¤"
      ),
      React.createElement("div", { className: "pcblock-wrap" },
        React.createElement("div", { className: "pcblock-card" },
          React.createElement("div", { className: "pcblock-emoji" }, "ğŸ“±"),
          React.createElement("div", { className: "pcblock-title" }, "ëª¨ë°”ì¼ ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤"),
          React.createElement("div", { className: "pcblock-desc" },
            "ì£¼ì°¨ìœ„ë°˜ ì œë³´ëŠ” í˜„ì¥ ì´¬ì˜ì´ í•„ìš”í•˜ì—¬\nëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œë§Œ ì ‘ìˆ˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\níœ´ëŒ€í°ìœ¼ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”."
          )
        )
      )
    );
  }
  
      const fileRef = useRef();

      const [location, setLocation] = useState("");
      const [plate, setPlate] = useState("");
      const [phone, setPhone] = useState(""); // ì„ íƒê°’(ì €ì¥ì€ ìˆ«ìë§Œ)
      const [note, setNote] = useState("");
      const [files, setFiles] = useState([]);
      const [agree, setAgree] = useState(false);
      const [loading, setLoading] = useState(false);
      const [toast, setToast] = useState("");
      const [toastType, setToastType] = useState("success");

      // objectURL ëˆ„ìˆ˜ ë°©ì§€
      const [previewUrls, setPreviewUrls] = useState([]);
      useEffect(() => {
        const urls = files.map(f => URL.createObjectURL(f));
        setPreviewUrls(urls);
        return () => urls.forEach(u => URL.revokeObjectURL(u));
      }, [files]);

      // ë¡œë”© ì¤‘ ìŠ¤í¬ë¡¤ ì ê¸ˆ(ëª¨ë‹¬ ë–  ìˆì„ ë•Œ)
      useEffect(() => {
        document.body.style.overflow = loading ? "hidden" : "";
        return () => { document.body.style.overflow = ""; };
      }, [loading]);

      // ìœ í‹¸: ì°¨ëŸ‰ë²ˆí˜¸ ê³µë°± ì œê±° + ì˜ë¬¸ ëŒ€ë¬¸ì
      function normalizePlate(v) {
        return (v || "").replace(/\s+/g, "").toUpperCase();
      }

      // ìœ í‹¸: ì—°ë½ì²˜ ìˆ«ìë§Œ + ìë™ í•˜ì´í”ˆ í¬ë§·(í‘œì‹œëŠ” í•˜ì´í”ˆ, ì €ì¥ì€ ìˆ«ìë§Œ)
      function formatPhone(v) {
        const digits = (v || "").replace(/\D/g, "");

        // 02 ì˜ˆì™¸
        if (digits.startsWith("02")) {
          if (digits.length <= 2) return digits;
          if (digits.length <= 5) return digits.replace(/(\d{2})(\d{1,3})/, "$1-$2");
          if (digits.length <= 9) return digits.replace(/(\d{2})(\d{3})(\d{1,4})/, "$1-$2-$3");
          return digits.slice(0, 10).replace(/(\d{2})(\d{4})(\d{4})/, "$1-$2-$3");
        }

        // ê·¸ ì™¸(010/011/031 ë“±)
        if (digits.length <= 3) return digits;
        if (digits.length <= 7) return digits.replace(/(\d{3})(\d{1,4})/, "$1-$2");
        if (digits.length <= 11) return digits.replace(/(\d{3})(\d{4})(\d{1,4})/, "$1-$2-$3");

        return digits.slice(0, 11).replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
      }

      const canSubmit = useMemo(
        () => location.trim() && plate.trim() && files.length > 0 && agree && !loading,
        [location, plate, files, agree, loading]
      );

      function onFiles(e) {
        const picked = Array.from(e.target.files || []);
        if (!picked.length) return;

        // ì¤‘ë³µ ë°©ì§€ + ìµœëŒ€ ì¥ìˆ˜ ì œí•œ
        setFiles(prev => {
          const map = new Map(prev.map(f => [f.name+"_"+f.size+"_"+f.lastModified, f]));
          for (const f of picked) map.set(f.name+"_"+f.size+"_"+f.lastModified, f);
          return Array.from(map.values()).slice(0, MAX_PHOTOS);
        });

        e.target.value = "";
      }

      function remove(idx) {
        setFiles(f => f.filter((_, i) => i !== idx));
      }

      // âœ… ì‚¬ì§„ ìš©ëŸ‰ ë¬¸ì œ ë°©ì§€: ìë™ ì••ì¶•(ê¸°ë³¸ 1024px, JPEG 0.72)  + ë¹ ë¥´ê²Œ
      async function fileToCompressedDataUrl(file, maxW = MAX_WIDTH, quality = JPEG_QUALITY) {
        const img = await new Promise((resolve, reject) => {
          const i = new Image();
          i.onload = () => resolve(i);
          i.onerror = reject;
          i.src = URL.createObjectURL(file);
        });

        const w0 = img.naturalWidth || img.width;
        const h0 = img.naturalHeight || img.height;
        const scale = Math.min(1, maxW / w0);
        const w = Math.round(w0 * scale);
        const h = Math.round(h0 * scale);

        const canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, w, h);

        try { URL.revokeObjectURL(img.src); } catch {}
        return canvas.toDataURL("image/jpeg", quality);
      }

      async function submit() {
        setToast("");
        setLoading(true);

        try {
          // âœ… ë³‘ë ¬ ì••ì¶•: ì²´ê° ì†ë„ í–¥ìƒ (ìˆœì°¨ for-await ì œê±°)
          const images = await Promise.all(
            files.map(f => fileToCompressedDataUrl(f, MAX_WIDTH, JPEG_QUALITY))
          );

          // âœ… Workerì— "ìˆœìˆ˜ ë°ì´í„°"ë§Œ ì „ì†¡ (Workerê°€ {action,data}ë¡œ ê°ì‹¸ GASë¡œ ì „ë‹¬)
          const res = await fetch(API_URL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
              location: location.trim(),
              plate: normalizePlate(plate),
              phone: phone.replace(/\D/g, ""), // âœ… ì €ì¥ì€ ìˆ«ìë§Œ: 01012345678
              note: note.trim(),
              images,
              ip: "-"
            })
          });

          const text = await res.text().catch(()=> "");
          let parsed = null;
          try { parsed = JSON.parse(text); } catch {}

          if (!res.ok) throw new Error(text || ("HTTP " + res.status));
          if (parsed && parsed.ok === false) {
            throw new Error("GAS/Worker ì˜¤ë¥˜\n" + JSON.stringify(parsed, null, 2));
          }

          setToastType("success");
          setToast("âœ… ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!");
          setLocation("");
          setPlate("");
          setPhone("");
          setNote("");
          setFiles([]);
          setAgree(false);

          setTimeout(() => setToast(""), 3200);
        } catch (e) {
          setToastType("error");
          setToast("âŒ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n" + String(e && e.message ? e.message : e));
        } finally {
          setLoading(false);
        }
      }

      return React.createElement("div", {className: "screen"},
        React.createElement("div", {className: "header"},
          React.createElement("h1", null, "ğŸš« ë¼ì´ë¸Œë”ì„¼í…€ ì£¼ì°¨ìœ„ë°˜ ì œë³´"),
          React.createElement("div", {className: "subtitle"}, "ìš°ë¦¬ ë‹¨ì§€ì˜ ì•ˆì „í•œ ì£¼ì°¨ ë¬¸í™”ë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ìš”")
        ),

        React.createElement("div", {className: "banner"},
          React.createElement("div", {className: "banner-content"},
            React.createElement("div", {className: "banner-title"}, "ë¶ˆë²• ì£¼ì°¨ ë° ìœ„ë°˜ ì‚¬í•­ì„ ì œë³´í•´ ì£¼ì„¸ìš”"),
            React.createElement("div", {className: "banner-desc"}, "ìœ„ë°˜ ì‚¬ì‹¤ì´ ëª…í™•íˆ í™•ì¸ë  ìˆ˜ ìˆë„ë¡ ì¦ê±°ì‚¬ì§„ì„ ì œì¶œí•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.")
          )
        ),

        React.createElement("div", {className: "section"},
          React.createElement("span", {className: "section-icon"}, "ğŸ“‹"),
          "ì‹ ê³  ë‚´ìš©"
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "ğŸ“"),
            "ìœ„ì¹˜"
          ),
          React.createElement("div", {className: "hint"}, "ë™Â·ì¸µÂ·êµ¬ì—­ì„ êµ¬ì²´ì ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”"),
          React.createElement("input", {
            type: "text",
            value: location,
            onChange: e => setLocation(e.target.value),
            placeholder: "ì˜ˆ: 101ë™ B2ì¸µ Aêµ¬ì—­"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "ğŸš—"),
            "ì°¨ëŸ‰ë²ˆí˜¸"
          ),
          React.createElement("div", {className: "hint"}, "ì°¨ëŸ‰ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”"),
          React.createElement("input", {
            type: "text",
            value: plate,
            onChange: e => setPlate(normalizePlate(e.target.value)),
            placeholder: "ì˜ˆ: 12ê°€3456",
            autoCapitalize: "characters"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "ğŸ“"),
            "ì—°ë½ì²˜ (ì„ íƒ)"
          ),
          React.createElement("div", {className: "hint"}, "ìˆ«ìë§Œ ì…ë ¥í•´ë„ ìë™ìœ¼ë¡œ 010-1234-5678 í˜•ì‹ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤"),
          React.createElement("input", {
            type: "text",
            value: phone,
            inputMode: "numeric",
            onChange: e => setPhone(formatPhone(e.target.value)),
            placeholder: "ì˜ˆ: 01012345678"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "ğŸ“¸"),
            "ì‚¬ì§„"
          ),
        React.createElement(
          "div",
          { className: "hint" },
          "ë²ˆí˜¸íŒê³¼ ì£¼ì°¨ ìœ„ì¹˜ê°€ í•¨ê»˜ ë³´ì´ê²Œ ì´¬ì˜í•´ ì£¼ì„¸ìš”",
          React.createElement("br"),
          `ìë™ ì••ì¶• ì „ì†¡ Â· ìµœëŒ€ ${MAX_PHOTOS}ì¥`
        ),
          files.length > 0 && React.createElement("div", {className: "photo-count"},
            `ğŸ“ ì‚¬ì§„ ${files.length}ì¥ ì²¨ë¶€ë¨`
          ),
          React.createElement("div", {className:"photo-limit"},
           
          ),

          React.createElement("button", {
            className: "btn",
            type: "button",
            onClick: () => fileRef.current && fileRef.current.click()
          }, "ì‚¬ì§„ ì´¬ì˜/ì¶”ê°€"),

          React.createElement("input", {
            ref: fileRef,
            type: "file",
            accept: "image/*",
            multiple: true,
            capture: "environment",
            onChange: onFiles,
            style: {display: "none"}
          }),

          previewUrls.length > 0 && React.createElement("div", {className: "previews"},
            previewUrls.map((url, i) =>
              React.createElement("div", {className: "thumb", key: i},
                React.createElement("img", {src: url, alt: "preview"}),
                React.createElement("button", {type:"button", onClick: () => remove(i)}, "Ã—")
              )
            )
          )
        ),

        React.createElement("div", {className: "section"},
          React.createElement("span", {className: "section-icon"}, "ğŸ“"),
          "ì¶”ê°€ ì •ë³´"
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", null,
            React.createElement("span", {className: "label-icon"}, "ğŸ“"),
            "ë¹„ê³  (ì„ íƒ)"
          ),
          React.createElement("div", {className: "hint"}, "ìƒìŠµ/ë°˜ë³µ ì—¬ë¶€, íŠ¹ì´ì‚¬í•­ì´ ìˆìœ¼ë©´ ë‚¨ê²¨ ì£¼ì„¸ìš”"),
          React.createElement("textarea", {
            value: note,
            onChange: e => setNote(e.target.value),
            placeholder: "ì˜ˆ: í†µí–‰ ë°©í•´, ìƒìŠµ ì£¼ì°¨ ë“±"
          })
        ),

        React.createElement("div", {className: "card"},
          React.createElement("label", {className: "checkbox-label"},
            React.createElement("input", {
              type: "checkbox",
              checked: agree,
              onChange: e => setAgree(e.target.checked)
            }),
            "ì¦ê±° ì œê³µ ë° ì²˜ë¦¬ì— ë™ì˜í•©ë‹ˆë‹¤"
          ),
          React.createElement("div", {className: "hint", style: {marginTop: "10px"}},
            `âœ“ ìœ„ì¹˜: ${location ? 'ì…ë ¥ë¨' : 'ë¯¸ì…ë ¥'} | ì°¨ëŸ‰ë²ˆí˜¸: ${plate ? 'ì…ë ¥ë¨' : 'ë¯¸ì…ë ¥'} | ì‚¬ì§„: ${files.length}ì¥ | ë™ì˜: ${agree ? 'ì™„ë£Œ' : 'í•„ìš”'}`
          )
        ),

        React.createElement("div", {className: "bottom"},
          React.createElement("div", {className: "bottom-content"},
            React.createElement("button", {
              className: "submit",
              disabled: !canSubmit,
              onClick: submit
            },
              loading && React.createElement("div", {className: "spinner"}),
              loading ? "ì œì¶œ ì¤‘..." : "ì œë³´ ì œì¶œ"
            ),
            toast && React.createElement(
              "div",
              { className: `toast ${toastType === 'error' ? 'error' : ''}` },
              toast
            )
          )
        ),

        /* âœ… Aì•ˆ: ì œì¶œ ì¤‘ íŒì—… ëª¨ë‹¬ */
        loading && React.createElement("div", { className: "modal-backdrop" },
          React.createElement("div", { className: "modal" },
            React.createElement("div", { className: "modal-title" }, "ì œì¶œ ì¤‘ì…ë‹ˆë‹¤â€¦"),
            React.createElement("div", { className: "modal-desc" },
              "ì‚¬ì§„ ì—…ë¡œë“œì™€ ì ‘ìˆ˜ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."
            ),
            React.createElement("div", { className: "modal-row" },
              React.createElement("div", { className: "modal-spinner" }),
              React.createElement("div", { style:{fontWeight:900, color:"#334155"} }, "ì²˜ë¦¬ ì¤‘")
            )
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>

  <script>
    // iOS/ëª¨ë°”ì¼ í•€ì¹˜ ì¤Œ ë°©ì§€(í•„ìš”ì‹œ)
    (function disableZoom(){
      document.addEventListener('gesturestart', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('gesturechange', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('gestureend', function(e){ e.preventDefault(); }, { passive:false });
      document.addEventListener('touchmove', function(e){
        if (e.scale && e.scale !== 1) e.preventDefault();
      }, { passive:false });
    })();
  </script>
</body>
</html>
